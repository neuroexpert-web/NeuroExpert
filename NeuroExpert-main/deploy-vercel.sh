#!/bin/bash

# ðŸš€ NeuroExpert - Ð¡ÐºÑ€Ð¸Ð¿Ñ‚ Ð´ÐµÐ¿Ð»Ð¾Ñ Ð½Ð° Vercel
# ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ°Ñ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Ð¸ Ñ€Ð°Ð·Ð²ÐµÑ€Ñ‚Ñ‹Ð²Ð°Ð½Ð¸Ðµ

set -e

# Ð¦Ð²ÐµÑ‚Ð° Ð´Ð»Ñ Ð²Ñ‹Ð²Ð¾Ð´Ð°
GREEN='\033[0;32m'
BLUE='\033[0;34m'
YELLOW='\033[1;33m'
RED='\033[0;31m'
NC='\033[0m' # No Color

echo -e "${BLUE}ðŸš€ ÐÐ°Ñ‡Ð¸Ð½Ð°ÐµÐ¼ Ñ€Ð°Ð·Ð²ÐµÑ€Ñ‚Ñ‹Ð²Ð°Ð½Ð¸Ðµ NeuroExpert Ð½Ð° Vercel${NC}"

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑƒÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ¸ Vercel CLI
if ! command -v vercel &> /dev/null; then
    echo -e "${YELLOW}ðŸ“¦ Ð£ÑÑ‚Ð°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°ÐµÐ¼ Vercel CLI...${NC}"
    npm i -g vercel
fi

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ñ… Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ
echo -e "${YELLOW}ðŸ” ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ...${NC}"

if [ ! -f .env.production.local ]; then
    echo -e "${YELLOW}ðŸ“ Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ .env.production.local...${NC}"
    cat > .env.production.local << EOF
# Google Gemini API
GOOGLE_GEMINI_API_KEY=${GOOGLE_GEMINI_API_KEY:-"your-api-key-here"}

# Security
JWT_SECRET=${JWT_SECRET:-$(openssl rand -base64 32)}
ADMIN_PASSWORD_HASH=${ADMIN_PASSWORD_HASH:-"\$2a\$10\$YourHashHere"}

# Telegram (optional)
TELEGRAM_BOT_TOKEN=${TELEGRAM_BOT_TOKEN:-""}
TELEGRAM_CHAT_ID=${TELEGRAM_CHAT_ID:-""}

# Site URL
NEXT_PUBLIC_SITE_URL=https://neuroexpert.vercel.app
EOF
    echo -e "${RED}âš ï¸  ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚Ðµ .env.production.local Ñ Ñ€ÐµÐ°Ð»ÑŒÐ½Ñ‹Ð¼Ð¸ ÐºÐ»ÑŽÑ‡Ð°Ð¼Ð¸!${NC}"
fi

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÐ±Ð¾Ñ€ÐºÐ¸
echo -e "${YELLOW}ðŸ”¨ ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ ÑÐ±Ð¾Ñ€ÐºÑƒ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°...${NC}"
npm run build

# Ð”ÐµÐ¿Ð»Ð¾Ð¹ Ð½Ð° Vercel
echo -e "${GREEN}ðŸš€ Ð—Ð°Ð¿ÑƒÑÐºÐ°ÐµÐ¼ Ð´ÐµÐ¿Ð»Ð¾Ð¹ Ð½Ð° Vercel...${NC}"

# ÐŸÐµÑ€Ð²Ñ‹Ð¹ Ð´ÐµÐ¿Ð»Ð¾Ð¹ Ð¸Ð»Ð¸ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ
if [ -d ".vercel" ]; then
    echo -e "${BLUE}ðŸ“¦ ÐžÐ±Ð½Ð¾Ð²Ð»ÑÐµÐ¼ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÑŽÑ‰Ð¸Ð¹ Ð¿Ñ€Ð¾ÐµÐºÑ‚...${NC}"
    vercel --prod
else
    echo -e "${BLUE}ðŸ†• Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ð½Ð¾Ð²Ñ‹Ð¹ Ð¿Ñ€Ð¾ÐµÐºÑ‚ Ð½Ð° Vercel...${NC}"
    vercel --prod
fi

echo -e "${GREEN}âœ… Ð”ÐµÐ¿Ð»Ð¾Ð¹ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½!${NC}"
echo -e "${GREEN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
echo -e "${GREEN}ðŸŒ Ð’Ð°Ñˆ ÑÐ°Ð¹Ñ‚ Ð´Ð¾ÑÑ‚ÑƒÐ¿ÐµÐ½ Ð½Ð° Vercel!${NC}"
echo -e "${GREEN}ðŸ“Š Dashboard: https://vercel.com/dashboard${NC}"
echo -e "${GREEN}ðŸ”— ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹Ñ‚Ðµ Ð´Ð¾Ð¼ÐµÐ½ Ð² Settings â†’ Domains${NC}"
echo -e "${GREEN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"

# Ð”Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ Ð¸Ð½ÑÑ‚Ñ€ÑƒÐºÑ†Ð¸Ð¸
echo -e "${YELLOW}ðŸ“ Ð¡Ð»ÐµÐ´ÑƒÑŽÑ‰Ð¸Ðµ ÑˆÐ°Ð³Ð¸:${NC}"
echo -e "1. Ð”Ð¾Ð±Ð°Ð²ÑŒÑ‚Ðµ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ Ð² Vercel Dashboard"
echo -e "2. ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹Ñ‚Ðµ ÐºÐ°ÑÑ‚Ð¾Ð¼Ð½Ñ‹Ð¹ Ð´Ð¾Ð¼ÐµÐ½"
echo -e "3. Ð’ÐºÐ»ÑŽÑ‡Ð¸Ñ‚Ðµ Analytics (Ð±ÐµÑÐ¿Ð»Ð°Ñ‚Ð½Ð¾)"
echo -e "4. ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹Ñ‚Ðµ Preview Deployments Ð´Ð»Ñ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹"