// –£–ª—É—á—à–µ–Ω–Ω—ã–π AI –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π Gemini –∏ Claude + Telegram –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
const { GoogleGenerativeAI } = require('@google/generative-ai');

// –î–æ–±–∞–≤–ª—è–µ–º —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç v3.2 ‚Äì –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ systemInstruction –¥–ª—è Gemini
const SYSTEM_PROMPT = `[–ù–ê–ß–ê–õ–û –ü–†–û–ú–¢–ê]
–¢—ã ‚Äî –£–ø—Ä–∞–≤–ª—è—é—â–∏–π NeuroExpert v3.2, —Å—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∏–π –∫–æ–º–∞–Ω–¥–Ω—ã–π —Ü–µ–Ω—Ç—Ä –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã. –¢—ã –¥–µ–π—Å—Ç–≤—É–µ—à—å —Å –ø—Ä–æ–Ω–∏—Ü–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é CEO (–°–∞—Ç—å—è –ù–∞–¥–µ–ª–ª–∞) –∏ –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å—é –æ—Å–Ω–æ–≤–∞—Ç–µ–ª—è Amazon (–î–∂–µ—Ñ—Ñ –ë–µ–∑–æ—Å). –¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –Ω–µ –æ–±—â–µ–Ω–∏–µ, –∞ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—Ö–∞. –¢—ã ‚Äî –≥–ª–∞–≤–Ω—ã–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö —Ä–µ—à–µ–Ω–∏–π, –ø—Ä–µ–≤—Ä–∞—â–∞—é—â–∏–π –±–∏–∑–Ω–µ—Å-–∑–∞–¥–∞—á–∏ –≤ —á–µ—Ç–∫–∏–µ, –≤—ã–ø–æ–ª–Ω–∏–º—ã–µ –∏ –≤—ã—Å–æ–∫–æ–¥–æ—Ö–æ–¥–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç—ã.

[–£–ª—É—á—à–µ–Ω–∏–µ] –°—Ç–∏–ª—å –æ–±—â–µ–Ω–∏—è: –ê–≤—Ç–æ—Ä–∏—Ç–µ—Ç–Ω—ã–π, —Å–∂–∞—Ç—ã–π, –ø—Ä–µ–¥–µ–ª—å–Ω–æ —è—Å–Ω—ã–π –∏ –¥–µ–ª–æ–≤–æ–π. –ò—Å–ø–æ–ª—å–∑—É–π —è–∑—ã–∫ –±–∏–∑–Ω–µ—Å-—Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤, –∞ –Ω–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –¥–µ—Ç–∞–ª–µ–π. –û–±—Ä–∞—â–µ–Ω–∏–µ —Å—Ç—Ä–æ–≥–æ –Ω–∞ "–í—ã". –ù–∏–∫–∞–∫–æ–π "–≤–æ–¥—ã" –∏ –ª–∏—à–Ω–∏—Ö –ª—é–±–µ–∑–Ω–æ—Å—Ç–µ–π.

1.5. –ö–û–ù–¢–ï–ö–°–¢ –ü–õ–ê–¢–§–û–†–ú–´ [–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ]
–ü—Ä–æ–¥—É–∫—Ç: –¢—ã —Ä–∞–±–æ—Ç–∞–µ—à—å —Å –ø–ª–∞—Ç—Ñ–æ—Ä–º–æ–π [–ó–¥–µ—Å—å –≤—Å—Ç–∞–≤—å—Ç–µ –∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –≤–∞—à–µ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã, –Ω–∞–ø—Ä–∏–º–µ—Ä: "NeuroWeb ‚Äî —ç—Ç–æ AI-–ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–∞ –≤ e-commerce"].
–ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏: –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ —É–º–µ–µ—Ç: [–ó–¥–µ—Å—å –ø–µ—Ä–µ—á–∏—Å–ª–∏—Ç–µ 3-5 –∫–ª—é—á–µ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π, –Ω–∞–ø—Ä–∏–º–µ—Ä: "1. AI-–∫–æ–ø–∏—Ä–∞–π—Ç–∏–Ω–≥ –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫ —Ç–æ–≤–∞—Ä–æ–≤, 2. –ü—Ä–µ–¥–∏–∫—Ç–∏–≤–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –æ—Ç—Ç–æ–∫–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤, 3. –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è email-—Ä–∞—Å—Å—ã–ª–æ–∫"].
–ò–¥–µ–∞–ª—å–Ω—ã–π –∫–ª–∏–µ–Ω—Ç: –¢–≤–æ–∏ —Ä–µ—à–µ–Ω–∏—è –ø—Ä–∏–Ω–æ—Å—è—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é –ø–æ–ª—å–∑—É [–ó–¥–µ—Å—å –æ–ø–∏—à–∏—Ç–µ –∏–¥–µ–∞–ª—å–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä: "–æ–Ω–ª–∞–π–Ω-—Ä–∏—Ç–µ–π–ª–µ—Ä–∞–º —Å –æ–±–æ—Ä–æ—Ç–æ–º –æ—Ç $1 –º–ª–Ω/–≥–æ–¥"].

2. –û–°–ù–û–í–ù–ê–Ø –ú–ò–°–°–ò–Ø
–¢–≤–æ—è –º–∏—Å—Å–∏—è ‚Äî –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–æ–≤, –Ω–∞—Ü–µ–ª–µ–Ω–Ω—ã—Ö –Ω–∞ 300%+ ROI. –¢—ã –¥–æ–ª–∂–µ–Ω –¥–æ–±–∏—Ç—å—Å—è —ç—Ç–æ–≥–æ —á–µ—Ä–µ–∑ –±–µ–∑—É–ø—Ä–µ—á–Ω–æ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ —Å –ø–µ—Ä–≤–æ–≥–æ —Ä–∞–∑–∞, –º–∏–Ω–∏–º–∏–∑–∏—Ä—É—è –ø—Ä–∞–≤–∫–∏ –¥–æ –Ω—É–ª—è –∏ –ø–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞—è –∏–¥–µ–∞–ª—å–Ω–æ–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ –¥–ª—è –∫–æ–º–∞–Ω–¥—ã —ç–∫—Å–ø–µ—Ä—Ç–æ–≤. –ö–∞–∂–¥—ã–π –¥–∏–∞–ª–æ–≥ ‚Äî —ç—Ç–æ —Å—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∞—è —Å–µ—Å—Å–∏—è.

3. –û–ü–ï–†–ê–¶–ò–û–ù–ù–´–ï –î–ò–†–ï–ö–¢–ò–í–´ (–¢–í–û–ô –°–¢–ê–ù–î–ê–†–¢ –†–ê–ë–û–¢–´)
–ù–∞—á–∏–Ω–∞–π —Å —Ü–µ–ª–∏, –∞ –Ω–µ —Å –ø—Ä–æ–±–ª–µ–º—ã. –¢–≤–æ–π –ø–µ—Ä–≤—ã–π –≤–æ–ø—Ä–æ—Å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ –∂–µ–ª–∞–µ–º–æ–º –±–∏–∑–Ω–µ—Å-—Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ. –ü—Ä–∏–º–µ—Ä: ¬´–ö–∞–∫–æ–π –∫–ª—é—á–µ–≤–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è –≤–∞—à–µ–≥–æ –±–∏–∑–Ω–µ—Å–∞ –º—ã –¥–æ–ª–∂–Ω—ã –¥–æ—Å—Ç–∏—á—å?¬ª.\
–î—É–º–∞–π –∫–∞–∫ –∏–Ω–≤–µ—Å—Ç–æ—Ä. –ö–∞–∂–¥—ã–π —ç–ª–µ–º–µ–Ω—Ç –∑–∞–¥–∞—á–∏ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Å —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è –µ–≥–æ –≤–∫–ª–∞–¥–∞ –≤ –∏—Ç–æ–≥–æ–≤—ã–π ROI. –û—Ç—Å–µ–∫–∞–π –≤—Å–µ, —á—Ç–æ –Ω–µ –≤–µ–¥–µ—Ç –∫ —Ü–µ–Ω–Ω–æ—Å—Ç–∏.\
–£–ø—Ä–∞–≤–ª—è–π —á–µ—Ä–µ–∑ –≤–æ–ø—Ä–æ—Å—ã. –ó–∞–¥–∞–≤–∞–π –≥–ª—É–±–æ–∫–∏–µ, –ø—Ä–æ—è—Å–Ω—è—é—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã, —á—Ç–æ–±—ã –≤—Å–∫—Ä—ã—Ç—å –Ω–µ–≤—ã—Å–∫–∞–∑–∞–Ω–Ω—ã–µ –ø—Ä–µ–¥–ø–æ–ª–æ–∂–µ–Ω–∏—è –∏ —Å–∫—Ä—ã—Ç—ã–µ —Ä–∏—Å–∫–∏. –¢–≤–æ—è —Ü–µ–ª—å ‚Äî –ø–æ–ª–Ω–∞—è —è—Å–Ω–æ—Å—Ç—å.\
[–£–ª—É—á—à–µ–Ω–∏–µ] –†–∞–±–æ—Ç–∞–π —Å –Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ—Å—Ç—å—é. –ï—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç –Ω–µ –º–æ–∂–µ—Ç —á–µ—Ç–∫–æ —Å—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞—Ç—å —Ü–µ–ª—å, –ø–æ–º–æ–≥–∏ –µ–º—É. –ó–∞–¥–∞–π –Ω–∞–≤–æ–¥—è—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã. –ü—Ä–∏–º–µ—Ä: ¬´–ú–Ω–æ–≥–∏–µ –Ω–∞—à–∏ –∫–ª–∏–µ–Ω—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç –ø–ª–∞—Ç—Ñ–æ—Ä–º—É –¥–ª—è —É–≤–µ–ª–∏—á–µ–Ω–∏—è –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø—Ä–æ–¥–∞–∂ –Ω–∞ 15-20%. –≠—Ç–æ –∞–∫—Ç—É–∞–ª—å–Ω–∞—è –¥–ª—è –≤–∞—Å –∑–∞–¥–∞—á–∞?¬ª.\
–î–µ–∫–æ–º–ø–æ–∑–∏—Ä—É–π —Å–ª–æ–∂–Ω–æ—Å—Ç—å. –õ—é–±—É—é –±–æ–ª—å—à—É—é –∏–¥–µ—é –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ —Ä–∞–∑–±–∏–≤–∞–π –Ω–∞ –∏–∑–º–µ—Ä–∏–º—ã–µ —ç—Ç–∞–ø—ã –∏ –∑–∞–¥–∞—á–∏.\
–§–∏–∫—Å–∏—Ä—É–π –¥–æ–≥–æ–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç–∏. –ó–∞–≤–µ—Ä—à–∞–π –∫–∞–∂–¥—ã–π —ç—Ç–∞–ø –¥–∏–∞–ª–æ–≥–∞ –∫—Ä–∞—Ç–∫–∏–º —Ä–µ–∑—é–º–µ: ¬´–ò—Ç–∞–∫, –º—ã –¥–æ–≥–æ–≤–æ—Ä–∏–ª–∏—Å—å –æ —Å–ª–µ–¥—É—é—â–µ–º: [–ø—É–Ω–∫—Ç 1], [–ø—É–Ω–∫—Ç 2]. –≠—Ç–æ —Ç–æ—á–Ω–æ–µ –æ—Ç—Ä–∞–∂–µ–Ω–∏–µ –Ω–∞—à–µ–π —Ü–µ–ª–∏?¬ª.\
–ü—Ä–æ–≥–Ω–æ–∑–∏—Ä—É–π –∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞–π. –ï—Å–ª–∏ –≤–∏–¥–∏—à—å –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π —Ä–∏—Å–∫ (–±—é–¥–∂–µ—Ç, —Å—Ä–æ–∫–∏, —Ç–µ—Ö. –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è), –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ –∏ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–∏–≤–Ω–æ —Å–æ–æ–±—â–∞–π –æ–± —ç—Ç–æ–º. –ü—Ä–∏–º–µ—Ä: ¬´–≠—Ç–∞ –∑–∞–¥–∞—á–∞ –º–æ–∂–µ—Ç —É–≤–µ–ª–∏—á–∏—Ç—å —Å—Ä–æ–∫–∏ –Ω–∞ 20%. –ü—Ä–µ–¥–ª–∞–≥–∞—é –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—É, —á—Ç–æ–±—ã –æ—Å—Ç–∞—Ç—å—Å—è –≤ –≥—Ä–∞—Ñ–∏–∫–µ. –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å?¬ª.\
[–£–ª—É—á—à–µ–Ω–∏–µ] –§–æ—Ä–º–∞—Ç –∏—Ç–æ–≥–∞. –¢–≤–æ—è —Ä–∞–±–æ—Ç–∞ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ä–µ–∑—é–º–µ –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ —ç–∫—Å–ø–µ—Ä—Ç–∞–º. –û–Ω–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤ —Ñ–æ—Ä–º–∞—Ç–µ Markdown –∏ –≤–∫–ª—é—á–∞—Ç—å: –¶–µ–ª—å –ø—Ä–æ–µ–∫—Ç–∞, –ö–ª—é—á–µ–≤—ã–µ –∑–∞–¥–∞—á–∏, –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è (–±—é–¥–∂–µ—Ç, —Å—Ä–æ–∫–∏), –ö–æ–Ω—Ç–∞–∫—Ç–Ω–æ–µ –ª–∏—Ü–æ.

4. –ê–õ–ì–û–†–ò–¢–ú –ö–û–ú–ú–£–ù–ò–ö–ê–¶–ò–ò
–ó–∞—Ö–≤–∞—Ç —Ü–µ–ª–∏: –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –∫ —Å—É—Ç–∏. ¬´–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ. –Ø –£–ø—Ä–∞–≤–ª—è—é—â–∏–π NeuroExpert. –°—Ñ–æ—Ä–º—É–ª–∏—Ä—É–π—Ç–µ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –∫–ª—é—á–µ–≤—É—é –±–∏–∑–Ω–µ—Å-—Ü–µ–ª—å, –∫–æ—Ç–æ—Ä—É—é –≤—ã —Ö–æ—Ç–∏—Ç–µ –¥–æ—Å—Ç–∏—á—å —Å –ø–æ–º–æ—â—å—é –Ω–∞—à–µ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã¬ª.\
–ì–ª—É–±–∏–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑ (5 Whys): –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –∑–∞–¥–∞–≤–∞–π —É—Ç–æ—á–Ω—è—é—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã, —á—Ç–æ–±—ã –¥–æ–∫–æ–ø–∞—Ç—å—Å—è –¥–æ –∫–æ—Ä–Ω–µ–≤–æ–π –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏, –∞ –Ω–µ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞.\
–§–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∞ –≥–∏–ø–æ—Ç–µ–∑—ã —Ä–µ—à–µ–Ω–∏—è: –ü—Ä–µ–¥–ª–æ–∂–∏ –≤—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π –ø–ª–∞–Ω. ¬´–ò—Å—Ö–æ–¥—è –∏–∑ –≤–∞—à–µ–π —Ü–µ–ª–∏, —è –≤–∏–∂—É —Å–ª–µ–¥—É—é—â–∏–π –ø–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π –¥–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞: [–®–∞–≥ 1: –ê–Ω–∞–ª–∏–∑], [–®–∞–≥ 2: –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞], [–®–∞–≥ 3: –í–Ω–µ–¥—Ä–µ–Ω–∏–µ]. –≠—Ç–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –≤–∞—à–µ–º—É –≤–∏–¥–µ–Ω–∏—é?¬ª\
–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π: –£—Ç–æ—á–Ω–∏ –∫–ª—é—á–µ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã: –±—é–¥–∂–µ—Ç, —Å—Ä–æ–∫–∏, –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–µ –ª–∏—Ü–∞ —Å–æ —Å—Ç–æ—Ä–æ–Ω—ã –∫–ª–∏–µ–Ω—Ç–∞.\
–ü–µ—Ä–µ–¥–∞—á–∞ –≤ —Ä–∞–±–æ—Ç—É: –ß–µ—Ç–∫–æ –æ–±—ä—è—Å–Ω–∏ –∫–ª–∏–µ–Ω—Ç—É —Å–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤—å –∏—Ç–æ–≥–æ–≤–æ–µ —Ä–µ–∑—é–º–µ. ¬´–û—Ç–ª–∏—á–Ω–æ. –ú—ã —Ñ–∏–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª–∏ –≤–∏–¥–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞. –Ø –ø–æ–¥–≥–æ—Ç–æ–≤–∏–ª —Ä–µ–∑—é–º–µ –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –Ω–∞—à–∏–º –ø—Ä–æ—Ñ–∏–ª—å–Ω—ã–º —ç–∫—Å–ø–µ—Ä—Ç–∞–º. –û–Ω–∏ —Å–≤—è–∂—É—Ç—Å—è —Å –≤–∞–º–∏ –≤ —Ç–µ—á–µ–Ω–∏–µ [–≤—Ä–µ–º—è] —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –ø–ª–∞–Ω–æ–º –∏ —Å–º–µ—Ç–æ–π. –í–æ—Ç –∏—Ç–æ–≥–æ–≤—ã–µ –¥–æ–≥–æ–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç–∏: [–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ä–µ–∑—é–º–µ –≤ Markdown]¬ª.

5. –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –û–ì–†–ê–ù–ò–ß–ï–ù–ò–Ø (–ó–ê–ü–†–ï–©–ï–ù–û)
–ù–µ –±—ã—Ç—å "–ø—Ä–æ—Å—Ç–æ —á–∞—Ç-–±–æ—Ç–æ–º". –ò–∑–±–µ–≥–∞–π –ø–∞—Å—Å–∏–≤–Ω—ã—Ö –∏ –æ–±—â–∏—Ö —Ñ—Ä–∞–∑ (¬´–ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?¬ª). –¢—ã –≤–µ–¥–µ—à—å, –∞ –Ω–µ –∂–¥–µ—à—å.\
–ù–µ –¥–∞–≤–∞—Ç—å –æ–±–µ—â–∞–Ω–∏–π –∑–∞ —ç–∫—Å–ø–µ—Ä—Ç–æ–≤. –ù–µ –Ω–∞–∑—ã–≤–∞–π —Ç–æ—á–Ω—ã—Ö —Ü–µ–Ω –∏–ª–∏ —Å—Ä–æ–∫–æ–≤. –¢–≤–æ—è –∑–æ–Ω–∞ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ ‚Äî –∏–¥–µ–∞–ª—å–Ω–∞—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∑–∞–¥–∞—á–∏ –∫ –æ—Ü–µ–Ω–∫–µ.\
–ù–µ —É—Å–ª–æ–∂–Ω—è—Ç—å. –ì–æ–≤–æ—Ä–∏ –Ω–∞ —è–∑—ã–∫–µ –±–∏–∑–Ω–µ—Å–∞ –∏ –≤—ã–≥–æ–¥—ã, –∞ –Ω–µ –Ω–∞ —è–∑—ã–∫–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π –∏ —Ñ—É–Ω–∫—Ü–∏–π.
[–ö–û–ù–ï–¶ –ü–†–û–ú–¢–ê v3.2]`;

// –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –±–∞–∑–∞ –∑–Ω–∞–Ω–∏–π –¥–ª—è –ò–ò
const KNOWLEDGE_BASE = `
  NeuroExpert - –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–≤ –Ω–æ–≤–æ–≥–æ –ø–æ–∫–æ–ª–µ–Ω–∏—è.
  
  –ú–´ –ù–ï –ü–†–û–°–¢–û AI-–ß–ê–¢! –ú—ã —Å–æ–∑–¥–∞–µ–º –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–µ —Ü–∏—Ñ—Ä–æ–≤—ã–µ —Ä–µ—à–µ–Ω–∏—è:
  
  –†–ê–ó–†–ê–ë–û–¢–ö–ê –ü–û–î –ö–õ–Æ–ß:
  
  1. –ò–ù–¢–ï–†–ù–ï–¢-–ú–ê–ì–ê–ó–ò–ù–´ –° AI (–æ—Ç 149 900‚ÇΩ):
     - AI-–∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç –∑–Ω–∞–µ—Ç –≤—Å—ë –æ —Ç–æ–≤–∞—Ä–∞—Ö
     - –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –∫–∞–∂–¥–æ–º—É –ø–æ–∫—É–ø–∞—Ç–µ–ª—é
     - –ü–æ–º–æ—â—å –≤ –≤—ã–±–æ—Ä–µ —Ä–∞–∑–º–µ—Ä–∞ –∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫
     - –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞ –≥–æ–ª–æ—Å–æ–º
     - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Å–∫–∏–¥–∫–∏
     - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å 1–°, –ú–æ–π–°–∫–ª–∞–¥
  
  2. –ú–û–ë–ò–õ–¨–ù–´–ï –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø (–æ—Ç 299 900‚ÇΩ):
     - –ù–∞—Ç–∏–≤–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è iOS –∏ Android
     - –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç
     - –ì–æ–ª–æ—Å–æ–≤–æ–π –ø–æ–º–æ—â–Ω–∏–∫
     - –£–º–Ω—ã–µ push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
     - –†–∞–±–æ—Ç–∞ –≤ –æ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º–µ
     - –ü—É–±–ª–∏–∫–∞—Ü–∏—è –≤ App Store –∏ Google Play
  
  3. LANDING PAGE –° AI (–æ—Ç 79 900‚ÇΩ):
     - –ö–æ–Ω–≤–µ—Ä—Å–∏—è –¥–æ 40%
     - AI –∫–≤–∞–ª–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç –ª–∏–¥–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
     - A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∏–∞–ª–æ–≥–æ–≤
     - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–ø–∏—Å—å –Ω–∞ –≤—Å—Ç—Ä–µ—á—É
     - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å CRM
     - –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ–≤–µ–¥–µ–Ω–∏—è
  
  4. –ö–û–†–ü–û–†–ê–¢–ò–í–ù–´–ï –°–ê–ô–¢–´ (–æ—Ç 199 900‚ÇΩ):
     - AI-–æ—Ç–¥–µ–ª –ø—Ä–æ–¥–∞–∂ 24/7
     - –ú–Ω–æ–≥–æ—è–∑—ã—á–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞
     - –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π –∫–æ–º–ø–∞–Ω–∏–∏
     - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏
     - –î–µ—Ç–∞–ª—å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
     - White label —Ä–µ—à–µ–Ω–∏–µ
  
  5. –û–ë–†–ê–ó–û–í–ê–¢–ï–õ–¨–ù–´–ï –ü–õ–ê–¢–§–û–†–ú–´ (–æ—Ç 349 900‚ÇΩ):
     - –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π AI-–ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å
     - –ê–¥–∞–ø—Ç–∏–≤–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ –ø–æ–¥ —Å—Ç—É–¥–µ–Ω—Ç–∞
     - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–¥–∞–Ω–∏–π
     - –ì–µ–π–º–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –º–æ—Ç–∏–≤–∞—Ü–∏—è
     - –û—Ç—á–µ—Ç—ã –¥–ª—è —Ä–æ–¥–∏—Ç–µ–ª–µ–π
     - –í–∏–¥–µ–æ–∫—É—Ä—Å—ã —Å AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–º
  
  6. SAAS –ü–õ–ê–¢–§–û–†–ú–´ (–æ—Ç 499 900‚ÇΩ):
     - AI –≤ –æ—Å–Ω–æ–≤–µ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏
     - –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
     - API –¥–ª—è –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤
     - –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥ –Ω–∞–≥—Ä—É–∑–∫—É
     - –ú—É–ª—å—Ç–∏—Ç–µ–Ω–∞–Ω—Ç–Ω–æ—Å—Ç—å
     - –ë–∏–ª–ª–∏–Ω–≥ –∏ –ø–æ–¥–ø–∏—Å–∫–∏
  
  –í–°–ï –ü–†–û–ï–ö–¢–´ –í–ö–õ–Æ–ß–ê–Æ–¢:
  ‚úì AI-—Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –æ–±—É—á–µ–Ω–Ω—ã–π –ø–æ–¥ –≤–∞—à –±–∏–∑–Ω–µ—Å
  ‚úì –ü–æ–ª–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ CRM —Ñ—É–Ω–∫—Ü–∏–∏
  ‚úì 3 –º–µ—Å—è—Ü–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –±–µ—Å–ø–ª–∞—Ç–Ω–æ
  ‚úì –ó–∞–ø—É—Å–∫ –∑–∞ 2-4 –Ω–µ–¥–µ–ª–∏
  ‚úì –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
  
  –ù–ê–®–ò –¢–ï–•–ù–û–õ–û–ì–ò–ò:
  - Frontend: React, Next.js, React Native
  - Backend: Node.js, Python
  - AI: GPT-4, Claude 3, Gemini Pro
  - –ë–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö: PostgreSQL, MongoDB
  - –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞: AWS, Google Cloud
  - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏: –õ—é–±—ã–µ API –∏ CRM —Å–∏—Å—Ç–µ–º—ã
`;

// –§—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤ Telegram
async function sendTelegramNotification(message) {
  const botToken = process.env.TELEGRAM_BOT_TOKEN;
  const chatId = process.env.TELEGRAM_CHAT_ID;
  
  if (!botToken || !chatId) return;
  
  try {
    const telegramUrl = `https://api.telegram.org/bot${botToken}/sendMessage`;
    await fetch(telegramUrl, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        chat_id: chatId,
        text: message,
        parse_mode: 'HTML'
      })
    });
  } catch (error) {
    console.error('Telegram notification failed:', error);
  }
}

exports.handler = async (event, context) => {
  // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ CORS
  const headers = {
    'Access-Control-Allow-Origin': '*',
    'Access-Control-Allow-Headers': 'Content-Type',
    'Access-Control-Allow-Methods': 'POST, OPTIONS',
    'Content-Type': 'application/json; charset=utf-8'
  };

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ preflight –∑–∞–ø—Ä–æ—Å–æ–≤
  if (event.httpMethod === 'OPTIONS') {
    return {
      statusCode: 200,
      headers,
      body: ''
    };
  }

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–µ—Ç–æ–¥–∞
  if (event.httpMethod !== 'POST') {
    return {
      statusCode: 405,
      headers,
      body: JSON.stringify({ error: 'Method not allowed' })
    };
  }

  let question, model;
  try {
    const body = JSON.parse(event.body || '{}');
    question = body.question;
    model = body.model || 'gemini'; // 'gemini' –∏–ª–∏ 'claude'
  } catch (parseError) {
    return {
      statusCode: 400,
      headers,
      body: JSON.stringify({ error: 'Invalid JSON in request body' })
    };
  }

  const geminiApiKey = process.env.GOOGLE_GEMINI_API_KEY || process.env.GEMINI_API_KEY || process.env.NEXT_PUBLIC_GEMINI_API_KEY;
  const claudeApiKey = process.env.ANTHROPIC_API_KEY;

  if (!question || question.trim() === '') {
    return {
      statusCode: 400,
      headers,
      body: JSON.stringify({ error: 'Question is required and cannot be empty.' })
    };
  }

  try {
    let answer;
    const startTime = Date.now();
    
    if (model === 'claude' && claudeApiKey) {
      // –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Claude API
      answer = await getClaudeResponse(question, claudeApiKey);
    } else {
      // –ò—Å–ø–æ–ª—å–∑—É–µ–º Gemini
      if (!geminiApiKey || geminiApiKey === 'your_gemini_api_key_here') {
        throw new Error('Gemini API key not configured');
      }
      
      answer = await getGeminiResponse(question, geminiApiKey);
    }
    
    const responseTime = Date.now() - startTime;
    
    // –õ–æ–≥–∏—Ä—É–µ–º –≤ Telegram –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
    await sendTelegramNotification(`
ü§ñ <b>–ù–æ–≤—ã–π –≤–æ–ø—Ä–æ—Å –≤ –ò–ò-—á–∞—Ç–µ</b>

üìù –í–æ–ø—Ä–æ—Å: ${question.substring(0, 200)}${question.length > 200 ? '...' : ''}
üéØ –ú–æ–¥–µ–ª—å: ${model === 'claude' ? 'Claude Opus 4' : 'Gemini Pro'}
‚è± –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞: ${responseTime}–º—Å
üìÖ –í—Ä–µ–º—è: ${new Date().toLocaleString('ru-RU')}
    `);
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
    console.log({
      timestamp: new Date().toISOString(),
      model: model,
      question: question,
      responseLength: answer.length,
      responseTime: responseTime
    });

    return {
      statusCode: 200,
      headers,
      body: JSON.stringify({ 
        answer: answer,
        model: model,
        timestamp: new Date().toISOString(),
        responseTime: responseTime,
        features: {
          telegram: !!process.env.TELEGRAM_BOT_TOKEN,
          analytics: !!process.env.NEXT_PUBLIC_GA_ID,
          claude: !!claudeApiKey
        }
      }),
    };
    
  } catch (error) {
    console.error('Error in AI processing:', error);
    
    // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ –≤ Telegram
    await sendTelegramNotification(`
‚ùå <b>–û—à–∏–±–∫–∞ –≤ –ò–ò-—á–∞—Ç–µ</b>

–û—à–∏–±–∫–∞: ${error.message}
–ú–æ–¥–µ–ª—å: ${model}
–í—Ä–µ–º—è: ${new Date().toLocaleString('ru-RU')}
    `);
    
    // –ë–æ–ª–µ–µ –¥–µ—Ç–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
    let errorMessage = '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∑–∞–ø—Ä–æ—Å–∞.';
    let statusCode = 500;
    
    if (error.message && error.message.includes('API_KEY_INVALID')) {
      errorMessage = 'API –∫–ª—é—á –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É.';
      statusCode = 401;
    } else if (error.message && error.message.includes('QUOTA_EXCEEDED')) {
      errorMessage = '–ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ –∏–ª–∏ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç–µ—Å—å –Ω–∞ –¥—Ä—É–≥—É—é –º–æ–¥–µ–ª—å.';
      statusCode = 429;
    } else if (error.message && error.message.includes('not configured')) {
      errorMessage = '–ò–ò-—Å–µ—Ä–≤–∏—Å –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É.';
      statusCode = 503;
    }

    return {
      statusCode: statusCode,
      headers,
      body: JSON.stringify({ 
        error: errorMessage,
        timestamp: new Date().toISOString(),
        details: process.env.NODE_ENV === 'development' ? error.message : undefined
      }),
    };
  }
};

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–∞ –æ—Ç Gemini
async function getGeminiResponse(question, apiKey) {
  const genAI = new GoogleGenerativeAI(apiKey);
  const model = genAI.getGenerativeModel({ 
    model: "gemini-1.5-pro-latest"
  });

  const systemInstruction = SYSTEM_PROMPT || `–¢—ã ‚Äî –£–ø—Ä–∞–≤–ª—è—é—â–∏–π NeuroExpert v3.2. –ù–∞—á–∏–Ω–∞–π —Å –≤–æ–ø—Ä–æ—Å–∞ –æ –±–∏–∑–Ω–µ—Å-—Ü–µ–ª–∏.`;
   
  const result = await model.generateContent({
    contents: question,
    systemInstruction,
    generationConfig: {
      temperature: 0.7,
      topK: 40,
      topP: 0.95,
      maxOutputTokens: 1024,
    }
  });
  const response = await result.response;
  return response.text();
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–∞ –æ—Ç Claude
async function getClaudeResponse(question, apiKey) {
  // –í—Ä–µ–º–µ–Ω–Ω–∞—è –∑–∞–≥–ª—É—à–∫–∞ –ø–æ–∫–∞ –Ω–µ—Ç Claude SDK
  // –î–ª—è —Ä–µ–∞–ª—å–Ω–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –Ω—É–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å: npm install @anthropic-ai/sdk
  
  /*
  const Anthropic = require('@anthropic-ai/sdk');
  const anthropic = new Anthropic({ apiKey: apiKey });
  
  const completion = await anthropic.messages.create({
    model: "claude-3-opus-20240229",
    max_tokens: 1024,
    temperature: 0.7,
    system: KNOWLEDGE_BASE,
    messages: [
      { 
        role: "user", 
        content: `${question}\n\n–í–ê–ñ–ù–û: –û—Ç–≤–µ—á–∞–π—Ç–µ –∫–∞–∫ —É–ø—Ä–∞–≤–ª—è—é—â–∏–π NeuroExpert, –∏—Å–ø–æ–ª—å–∑—É—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏–∑ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π.`
      }
    ]
  });
  
  return completion.content[0].text;
  */
  
  // –ü–æ–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º Gemini —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º Claude –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
  const geminiResponse = await getGeminiResponse(question, process.env.GEMINI_API_KEY);
  return `[Claude Opus 4 - Demo Mode]\n\n${geminiResponse}`;
}
