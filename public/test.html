<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NeuroExpert - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #0a0e27;
            color: #f8fafc;
        }
        .test-section {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        h1, h2 {
            color: #667eea;
        }
        button {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }
        button:hover {
            opacity: 0.9;
        }
        .result {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
            font-family: monospace;
            font-size: 14px;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        .success {
            border-left: 4px solid #10b981;
        }
        .error {
            border-left: 4px solid #ef4444;
        }
        .loading {
            opacity: 0.6;
        }
    </style>
</head>
<body>
    <h1>üß™ NeuroExpert - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º</h1>
    
    <div class="test-section">
        <h2>1. –ü–æ–ª–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞</h2>
        <button onclick="runDebug()">üîç –ó–∞–ø—É—Å—Ç–∏—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É</button>
        <div id="debug-result" class="result"></div>
    </div>

    <div class="test-section">
        <h2>2. –¢–µ—Å—Ç AI –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞</h2>
        <button onclick="testAI()">ü§ñ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å AI</button>
        <button onclick="testAIChat()">üí¨ –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ</button>
        <div id="ai-result" class="result"></div>
    </div>

    <div class="test-section">
        <h2>3. –¢–µ—Å—Ç Telegram</h2>
        <button onclick="testTelegram()">üì± –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Telegram</button>
        <button onclick="sendTestForm()">üìß –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é —Ñ–æ—Ä–º—É</button>
        <div id="telegram-result" class="result"></div>
    </div>

    <div class="test-section">
        <h2>4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è</h2>
        <button onclick="checkEnv()">üîê –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ</button>
        <div id="env-result" class="result"></div>
    </div>

    <script>
        async function runDebug() {
            const resultDiv = document.getElementById('debug-result');
            resultDiv.innerHTML = '–ó–∞–≥—Ä—É–∑–∫–∞...';
            resultDiv.className = 'result loading';
            
            try {
                const response = await fetch('/api/debug');
                const data = await response.json();
                
                resultDiv.innerHTML = JSON.stringify(data, null, 2);
                resultDiv.className = 'result ' + (data.tests?.gemini?.success && data.tests?.telegram?.success ? 'success' : 'error');
            } catch (error) {
                resultDiv.innerHTML = '–û—à–∏–±–∫–∞: ' + error.message;
                resultDiv.className = 'result error';
            }
        }

        async function testAI() {
            const resultDiv = document.getElementById('ai-result');
            resultDiv.innerHTML = '–ü—Ä–æ–≤–µ—Ä–∫–∞ AI API...';
            resultDiv.className = 'result loading';
            
            try {
                const response = await fetch('/api/assistant/test');
                const data = await response.json();
                
                resultDiv.innerHTML = JSON.stringify(data, null, 2);
                resultDiv.className = 'result ' + (data.geminiTest?.success ? 'success' : 'error');
            } catch (error) {
                resultDiv.innerHTML = '–û—à–∏–±–∫–∞: ' + error.message;
                resultDiv.className = 'result error';
            }
        }

        async function testAIChat() {
            const resultDiv = document.getElementById('ai-result');
            resultDiv.innerHTML = '–û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è AI...';
            resultDiv.className = 'result loading';
            
            try {
                const response = await fetch('/api/assistant', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        question: '–ü—Ä–∏–≤–µ—Ç! –≠—Ç–æ —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ. –û—Ç–≤–µ—Ç—å –∫—Ä–∞—Ç–∫–æ.',
                        model: 'gemini'
                    })
                });
                const data = await response.json();
                
                resultDiv.innerHTML = JSON.stringify(data, null, 2);
                resultDiv.className = 'result ' + (data.answer ? 'success' : 'error');
            } catch (error) {
                resultDiv.innerHTML = '–û—à–∏–±–∫–∞: ' + error.message;
                resultDiv.className = 'result error';
            }
        }

        async function testTelegram() {
            const resultDiv = document.getElementById('telegram-result');
            resultDiv.innerHTML = '–ü—Ä–æ–≤–µ—Ä–∫–∞ Telegram API...';
            resultDiv.className = 'result loading';
            
            try {
                const response = await fetch('/api/telegram/test');
                const data = await response.json();
                
                resultDiv.innerHTML = JSON.stringify(data, null, 2);
                resultDiv.className = 'result ' + (data.tests?.sendMessage?.success ? 'success' : 'error');
            } catch (error) {
                resultDiv.innerHTML = '–û—à–∏–±–∫–∞: ' + error.message;
                resultDiv.className = 'result error';
            }
        }

        async function sendTestForm() {
            const resultDiv = document.getElementById('telegram-result');
            resultDiv.innerHTML = '–û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–π —Ñ–æ—Ä–º—ã...';
            resultDiv.className = 'result loading';
            
            try {
                const response = await fetch('/api/contact-form', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        name: '–¢–µ—Å—Ç–æ–≤–æ–µ –∏–º—è',
                        email: 'test@example.com',
                        phone: '+7 (999) 123-45-67',
                        message: '–≠—Ç–æ —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π'
                    })
                });
                const data = await response.json();
                
                resultDiv.innerHTML = JSON.stringify(data, null, 2);
                resultDiv.className = 'result ' + (data.success ? 'success' : 'error');
            } catch (error) {
                resultDiv.innerHTML = '–û—à–∏–±–∫–∞: ' + error.message;
                resultDiv.className = 'result error';
            }
        }

        async function checkEnv() {
            const resultDiv = document.getElementById('env-result');
            resultDiv.innerHTML = '–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏...';
            resultDiv.className = 'result loading';
            
            const checks = {
                'Gemini API': await testEndpoint('/api/assistant/test'),
                'Telegram API': await testEndpoint('/api/telegram/test'),
                'Debug API': await testEndpoint('/api/debug'),
                'Health Check': await testEndpoint('/api/health')
            };
            
            let result = '–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏:\n\n';
            for (const [name, status] of Object.entries(checks)) {
                result += `${status ? '‚úÖ' : '‚ùå'} ${name}\n`;
            }
            
            resultDiv.innerHTML = result;
            resultDiv.className = 'result';
        }

        async function testEndpoint(url) {
            try {
                const response = await fetch(url);
                return response.ok;
            } catch {
                return false;
            }
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ–º –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', () => {
            runDebug();
        });
    </script>
</body>
</html>