# üì± TELEGRAM –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø - –ü–û–î–†–û–ë–ù–ê–Ø –ù–ê–°–¢–†–û–ô–ö–ê

## üéØ –ü–û–õ–ù–û–ï –†–£–ö–û–í–û–î–°–¢–í–û –ü–û TELEGRAM –î–õ–Ø NEUROEXPERT

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç **–∏—Å—á–µ—Ä–ø—ã–≤–∞—é—â–∏–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏** –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ Telegram –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –∫–æ–º–∞–Ω–¥, —Å–∫—Ä–∏–ø—Ç–∞–º–∏ –∏ troubleshooting.

---

## ü§ñ –°–û–ó–î–ê–ù–ò–ï TELEGRAM –ë–û–¢–ê

### –®–∞–≥ 1: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ @BotFather

1. **–ù–∞–π–¥–∏—Ç–µ @BotFather** –≤ Telegram: [t.me/botfather](https://t.me/botfather)
2. **–û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—ã**:
   ```
   /start
   /newbot
   ```
3. **–í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ**:
   - –ò–º—è –±–æ—Ç–∞: `NeuroExpert Notifications`
   - Username: `neuroexpert_notifications_bot`
   - –û–ø–∏—Å–∞–Ω–∏–µ: `–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –∑–∞—è–≤–∫–∞—Ö —Å –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã NeuroExpert`

4. **–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ç–æ–∫–µ–Ω**: `1234567890:AAEhBP0av18gDaXwBgKen6rG9aTzjrun4q8`

### –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–æ—Ç–∞ –≤ @BotFather

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ–ø–∏—Å–∞–Ω–∏—è
/setdescription
NeuroExpert Notifications Bot

–ë–æ—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ –Ω–æ–≤—ã—Ö –∑–∞—è–≤–∫–∞—Ö, —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Å–æ–±—ã—Ç–∏—è—Ö –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã NeuroExpert.

–§—É–Ω–∫—Ü–∏–∏:
üÜï –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –∑–∞—è–≤–∫–∞—Ö
üìä –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞  
‚ö° –°–∏—Å—Ç–µ–º–Ω—ã–µ –∞–ª–µ—Ä—Ç—ã
üõ°Ô∏è –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

# –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ
/setabouttext
–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –±–æ—Ç –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã NeuroExpert –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

# –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞
/setcommands
start - üöÄ –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞ –∏ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
status - ‚ö° –°—Ç–∞—Ç—É—Å –≤—Å–µ—Ö —Å–∏—Å—Ç–µ–º –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
stats - üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ —Å–µ–≥–æ–¥–Ω—è/–Ω–µ–¥–µ–ª—é/–º–µ—Å—è—Ü
leads - üìã –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞—è–≤–∫–∏ (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤)
health - üíö –î–µ—Ç–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–∏—Å—Ç–µ–º—ã
analytics - üìà –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ
settings - ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
help - ‚ùì –ü–æ–º–æ—â—å –∏ —Å–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥
ping - üèì –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–≤—è–∑–∏ —Å –±–æ—Ç–æ–º

# –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
/setjoingroups - Disable
/setprivacy - Disable
```

---

## üÜî –ü–û–õ–£–ß–ï–ù–ò–ï CHAT ID (3 –°–ü–û–°–û–ë–ê)

### –°–ø–æ—Å–æ–± 1: –ß–µ—Ä–µ–∑ API (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

1. **–û—Ç–ø—Ä–∞–≤—å—Ç–µ –ª—é–±–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –±–æ—Ç—É** (–Ω–∞–ø—Ä–∏–º–µ—Ä: "–ü—Ä–∏–≤–µ—Ç")
2. **–û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ**:
   ```
   https://api.telegram.org/bot<YOUR_BOT_TOKEN>/getUpdates
   ```
3. **–ù–∞–π–¥–∏—Ç–µ –≤ JSON –æ—Ç–≤–µ—Ç–µ**:
   ```json
   {
     "update_id": 123456789,
     "message": {
       "message_id": 1,
       "from": {
         "id": 987654321,
         "is_bot": false,
         "first_name": "–í–∞—à–µ –ò–º—è"
       },
       "chat": {
         "id": 987654321,  <- –≠–¢–û –í–ê–® CHAT_ID
         "first_name": "–í–∞—à–µ –ò–º—è",
         "type": "private"
       }
     }
   }
   ```

### –°–ø–æ—Å–æ–± 2: –î–ª—è –≥—Ä—É–ø–ø–æ–≤–æ–≥–æ —á–∞—Ç–∞

1. **–î–æ–±–∞–≤—å—Ç–µ –±–æ—Ç–∞ –≤ –≥—Ä—É–ø–ø—É**
2. **–°–¥–µ–ª–∞–π—Ç–µ –±–æ—Ç–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º** (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ!)
3. **–û—Ç–ø—Ä–∞–≤—å—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –≥—Ä—É–ø–ø—É**: `/start`
4. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ—Ç –∂–µ API –∑–∞–ø—Ä–æ—Å**
5. **Chat ID –≥—Ä—É–ø–ø—ã –±—É–¥–µ—Ç –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º**: `-1001234567890`

### –°–ø–æ—Å–æ–± 3: –ß–µ—Ä–µ–∑ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö –±–æ—Ç–æ–≤

1. **@userinfobot**: [t.me/userinfobot](https://t.me/userinfobot)
   - –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/start` 
   - –ü–æ–ª—É—á–∏—Ç–µ –≤–∞—à User ID

2. **@get_id_bot**: [t.me/get_id_bot](https://t.me/get_id_bot)
   - –î–æ–±–∞–≤—å—Ç–µ –≤ –≥—Ä—É–ø–ø—É –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è Group ID

---

## ‚öôÔ∏è –ü–ï–†–ï–ú–ï–ù–ù–´–ï –û–ö–†–£–ñ–ï–ù–ò–Ø

### –ë–∞–∑–æ–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:
```env
# –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
TELEGRAM_BOT_TOKEN=1234567890:AAEhBP0av18gDaXwBgKen6rG9aTzjrun4q8
TELEGRAM_CHAT_ID=987654321
TELEGRAM_ADMIN_CHAT_ID=987654321

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
TELEGRAM_NOTIFICATIONS_ENABLED=true
TELEGRAM_ALERTS_ENABLED=true
TELEGRAM_DEBUG_ENABLED=false

# –î–ª—è –≥—Ä—É–ø–ø–æ–≤—ã—Ö —á–∞—Ç–æ–≤
TELEGRAM_GROUP_CHAT_ID=-1001234567890
TELEGRAM_THREAD_ID=123  # –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ —Ç–æ–ø–∏–∫–∏
```

### –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:
```env
# –†–∞–∑–Ω—ã–µ —Ç–∏–ø—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤ —Ä–∞–∑–Ω—ã–µ —á–∞—Ç—ã
TELEGRAM_LEADS_CHAT_ID=111111111      # –ó–∞—è–≤–∫–∏
TELEGRAM_ALERTS_CHAT_ID=222222222     # –ê–ª–µ—Ä—Ç—ã  
TELEGRAM_ANALYTICS_CHAT_ID=333333333  # –ê–Ω–∞–ª–∏—Ç–∏–∫–∞
TELEGRAM_LOGS_CHANNEL_ID=-1001111111  # –õ–æ–≥–∏ (–∫–∞–Ω–∞–ª)

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏
TELEGRAM_RATE_LIMIT=20                # –°–æ–æ–±—â–µ–Ω–∏–π –≤ –º–∏–Ω—É—Ç—É
TELEGRAM_RETRY_ATTEMPTS=3             # –ü–æ–ø—ã—Ç–∫–∏ –ø–æ–≤—Ç–æ—Ä–∞
TELEGRAM_TIMEOUT=10000                # –¢–∞–π–º–∞—É—Ç –≤ –º—Å

# Webhook –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
TELEGRAM_WEBHOOK_URL=https://neuroexpert.ai/api/telegram-webhook
TELEGRAM_WEBHOOK_SECRET=your_webhook_secret_key
```

---

## üì¨ –¢–ò–ü–´ –£–í–ï–î–û–ú–õ–ï–ù–ò–ô –ò –®–ê–ë–õ–û–ù–´

### 1. –ù–æ–≤–∞—è –∑–∞—è–≤–∫–∞
```javascript
const newLeadTemplate = `üÜï <b>–ù–æ–≤–∞—è –∑–∞—è–≤–∫–∞!</b>

üë§ <b>–ò–º—è:</b> {name}
üè¢ <b>–ö–æ–º–ø–∞–Ω–∏—è:</b> {company}
üìß <b>Email:</b> {email}
üì± <b>–¢–µ–ª–µ—Ñ–æ–Ω:</b> {phone}
üíº <b>–¢–µ–º–∞:</b> {topic}
üí¨ <b>–°–æ–æ–±—â–µ–Ω–∏–µ:</b> {message}

üîó <b>–ò—Å—Ç–æ—á–Ω–∏–∫:</b> {source}
üåç <b>–õ–æ–∫–∞—Ü–∏—è:</b> {location}
üïê <b>–í—Ä–µ–º—è:</b> {timestamp}

<i>–û—Ç–≤–µ—Ç–∏—Ç—å –≤ —Ç–µ—á–µ–Ω–∏–µ 15 –º–∏–Ω—É—Ç –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –∫–æ–Ω–≤–µ—Ä—Å–∏–∏!</i>`;
```

### 2. –°–∏—Å—Ç–µ–º–Ω—ã–µ –∞–ª–µ—Ä—Ç—ã
```javascript
const systemAlertTemplate = `üö® <b>–°–∏—Å—Ç–µ–º–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ</b>

‚ö†Ô∏è <b>–¢–∏–ø:</b> {alertType}
üîß <b>–ö–æ–º–ø–æ–Ω–µ–Ω—Ç:</b> {component}
üìù <b>–û–ø–∏—Å–∞–Ω–∏–µ:</b> {message}
üìä <b>–£—Ä–æ–≤–µ–Ω—å:</b> {severity}

üïê <b>–í—Ä–µ–º—è:</b> {timestamp}
üîó <b>–ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏:</b> https://neuroexpert.ai/admin

{actionRequired}`;
```

### 3. –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
```javascript
const dailyStatsTemplate = `üìä <b>–û—Ç—á–µ—Ç –∑–∞ {date}</b>

üë• <b>–ü–æ—Å–µ—â–µ–Ω–∏–π:</b> {visits} ({visitsTrend})
üÜï <b>–ù–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:</b> {newUsers} ({newUsersTrend})
üìù <b>–ó–∞—è–≤–æ–∫:</b> {leads} ({leadsTrend})
üí∞ <b>–ö–æ–Ω–≤–µ—Ä—Å–∏—è:</b> {conversion}% ({conversionTrend})

üîù <b>–¢–æ–ø –∏—Å—Ç–æ—á–Ω–∏–∫–∏:</b>
{topSources}

üìà <b>–¢—Ä–µ–Ω–¥ –Ω–µ–¥–µ–ª–∏:</b> {weeklyTrend}`;
```

### 4. Performance –∞–ª–µ—Ä—Ç—ã
```javascript
const performanceAlertTemplate = `‚ö° <b>Performance Alert</b>

üìä <b>–ú–µ—Ç—Ä–∏–∫–∞:</b> {metric}
üìà <b>–ó–Ω–∞—á–µ–Ω–∏–µ:</b> {value} ({threshold})
üéØ <b>–°—Ç—Ä–∞–Ω–∏—Ü–∞:</b> {page}

üïê <b>–í—Ä–µ–º—è:</b> {timestamp}
üîß <b>–î–µ–π—Å—Ç–≤–∏–µ:</b> {recommendedAction}`;
```

---

## üéÆ –ò–ù–¢–ï–†–ê–ö–¢–ò–í–ù–´–ï –ö–û–ú–ê–ù–î–´ –ë–û–¢–ê

### –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥:
```javascript
// app/api/telegram-webhook/route.js
export async function POST(request) {
  const body = await request.json();
  const { message, callback_query } = body;
  
  if (message?.text) {
    await handleTextMessage(message);
  }
  
  if (callback_query) {
    await handleCallbackQuery(callback_query);
  }
  
  return new Response('OK');
}

async function handleTextMessage(message) {
  const chatId = message.chat.id;
  const text = message.text;
  const userId = message.from.id;
  
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
  if (!isAuthorizedUser(userId)) {
    await sendMessage(chatId, '‚ùå –£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —ç—Ç–æ–º—É –±–æ—Ç—É');
    return;
  }
  
  switch (text) {
    case '/start':
      await sendWelcomeMessage(chatId, message.from.first_name);
      break;
      
    case '/status':
      await sendSystemStatus(chatId);
      break;
      
    case '/stats':
      await sendStatistics(chatId);
      break;
      
    case '/leads':
      await sendRecentLeads(chatId);
      break;
      
    case '/health':
      await sendHealthCheck(chatId);
      break;
      
    case '/analytics':
      await sendAnalytics(chatId);
      break;
      
    case '/settings':
      await sendSettingsMenu(chatId);
      break;
      
    case '/help':
      await sendHelpMessage(chatId);
      break;
      
    case '/ping':
      await sendMessage(chatId, 'üèì –ü–æ–Ω–≥! –ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –∏—Å–ø—Ä–∞–≤–Ω–æ');
      break;
      
    default:
      await sendMessage(chatId, '‚ùì –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /help');
  }
}
```

### –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏:
```javascript
async function sendSettingsMenu(chatId) {
  const keyboard = {
    inline_keyboard: [
      [
        { text: 'üîî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –í–ö–õ', callback_data: 'toggle_notifications' },
        { text: 'üö® –ê–ª–µ—Ä—Ç—ã –í–ö–õ', callback_data: 'toggle_alerts' }
      ],
      [
        { text: 'üìä –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –æ—Ç—á–µ—Ç—ã', callback_data: 'toggle_daily_reports' },
        { text: '‚ö° Performance –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥', callback_data: 'toggle_performance' }
      ],
      [
        { text: 'üõ†Ô∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤', callback_data: 'filter_settings' },
        { text: '‚è∞ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–æ–≤', callback_data: 'schedule_settings' }
      ]
    ]
  };
  
  await sendMessage(chatId, '‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:', keyboard);
}
```

---

## üîß –¢–ï–•–ù–ò–ß–ï–°–ö–ê–Ø –†–ï–ê–õ–ò–ó–ê–¶–ò–Ø

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:
```javascript
// app/utils/telegram.js
class TelegramBot {
  constructor() {
    this.token = process.env.TELEGRAM_BOT_TOKEN;
    this.baseUrl = `https://api.telegram.org/bot${this.token}`;
  }
  
  async sendMessage(chatId, text, keyboard = null) {
    const payload = {
      chat_id: chatId,
      text: text,
      parse_mode: 'HTML',
      disable_web_page_preview: true
    };
    
    if (keyboard) {
      payload.reply_markup = keyboard;
    }
    
    const response = await fetch(`${this.baseUrl}/sendMessage`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    });
    
    return response.json();
  }
  
  async sendPhoto(chatId, photo, caption = '') {
    const payload = {
      chat_id: chatId,
      photo: photo,
      caption: caption,
      parse_mode: 'HTML'
    };
    
    const response = await fetch(`${this.baseUrl}/sendPhoto`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    });
    
    return response.json();
  }
  
  async sendDocument(chatId, document, caption = '') {
    const formData = new FormData();
    formData.append('chat_id', chatId);
    formData.append('document', document);
    formData.append('caption', caption);
    
    const response = await fetch(`${this.baseUrl}/sendDocument`, {
      method: 'POST',
      body: formData
    });
    
    return response.json();
  }
}
```

### –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ:
```javascript
// app/utils/telegram-scheduler.js
import cron from 'node-cron';

// –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –æ—Ç—á–µ—Ç –≤ 9:00
cron.schedule('0 9 * * *', async () => {
  const stats = await getDailyStats();
  const message = formatDailyReport(stats);
  await sendToAdmins(message);
});

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–∏—Å—Ç–µ–º—ã –∫–∞–∂–¥—ã–µ 15 –º–∏–Ω—É—Ç
cron.schedule('*/15 * * * *', async () => {
  const health = await checkSystemHealth();
  if (health.status !== 'healthy') {
    await sendAlert(`üö® –°–∏—Å—Ç–µ–º–∞ —Ç—Ä–µ–±—É–µ—Ç –≤–Ω–∏–º–∞–Ω–∏—è: ${health.message}`);
  }
});

// –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç –ø–æ –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å—è–º –≤ 10:00
cron.schedule('0 10 * * 0', async () => {
  const weeklyStats = await getWeeklyStats();
  const report = await generateWeeklyReport(weeklyStats);
  await sendDocument(ADMIN_CHAT_ID, report, 'üìä –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç');
});
```

---

## üõ°Ô∏è –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨ –ò –ü–†–ê–í–ê –î–û–°–¢–£–ü–ê

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–æ–º:
```javascript
// app/utils/telegram-auth.js
const AUTHORIZED_USERS = [
  123456789,  // –û—Å–Ω–æ–≤–Ω–æ–π –∞–¥–º–∏–Ω
  987654321,  // –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –∞–¥–º–∏–Ω
  555666777   // –ú–µ–Ω–µ–¥–∂–µ—Ä
];

const USER_ROLES = {
  123456789: 'super_admin',
  987654321: 'admin', 
  555666777: 'manager'
};

function isAuthorizedUser(userId) {
  return AUTHORIZED_USERS.includes(userId);
}

function getUserRole(userId) {
  return USER_ROLES[userId] || 'guest';
}

function hasPermission(userId, action) {
  const role = getUserRole(userId);
  
  const permissions = {
    super_admin: ['*'],
    admin: ['view_stats', 'view_leads', 'system_control'],
    manager: ['view_stats', 'view_leads'],
    guest: []
  };
  
  return permissions[role]?.includes(action) || permissions[role]?.includes('*');
}
```

### Rate limiting:
```javascript
// app/utils/telegram-rate-limit.js
const userRateLimits = new Map();

function checkRateLimit(userId) {
  const now = Date.now();
  const userLimit = userRateLimits.get(userId) || { count: 0, resetTime: now + 60000 };
  
  if (now > userLimit.resetTime) {
    userLimit.count = 0;
    userLimit.resetTime = now + 60000;
  }
  
  if (userLimit.count >= 10) { // 10 –∫–æ–º–∞–Ω–¥ –≤ –º–∏–Ω—É—Ç—É
    return false;
  }
  
  userLimit.count++;
  userRateLimits.set(userId, userLimit);
  return true;
}
```

---

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ò –û–¢–õ–ê–î–ö–ê

### –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ API
curl "https://api.telegram.org/bot<BOT_TOKEN>/getMe"

# –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
curl -X POST "https://api.telegram.org/bot<BOT_TOKEN>/sendMessage" \
  -H "Content-Type: application/json" \
  -d '{
    "chat_id": "<CHAT_ID>",
    "text": "üß™ –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è NeuroExpert"
  }'

# –ü–æ–ª—É—á–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
curl "https://api.telegram.org/bot<BOT_TOKEN>/getUpdates"

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ webhook
curl -X POST "https://api.telegram.org/bot<BOT_TOKEN>/setWebhook" \
  -H "Content-Type: application/json" \
  -d '{
    "url": "https://neuroexpert.ai/api/telegram-webhook",
    "secret_token": "your_secret_token"
  }'

# –£–¥–∞–ª–µ–Ω–∏–µ webhook (–¥–ª—è –æ—Ç–ª–∞–¥–∫–∏)
curl -X POST "https://api.telegram.org/bot<BOT_TOKEN>/deleteWebhook"
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ API –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã:
```bash
# –¢–µ—Å—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤–æ–π –∑–∞—è–≤–∫–µ
curl -X POST "http://localhost:3000/api/telegram-notify" \
  -H "Content-Type: application/json" \
  -d '{
    "type": "new_lead",
    "data": {
      "name": "–¢–µ—Å—Ç–æ–≤—ã–π –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å",
      "company": "–û–û–û –¢–µ—Å—Ç",
      "email": "test@test.com",
      "phone": "+7 (999) 123-45-67",
      "message": "–¢–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ"
    }
  }'

# –¢–µ—Å—Ç —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –∞–ª–µ—Ä—Ç–∞
curl -X POST "http://localhost:3000/api/telegram-notify" \
  -H "Content-Type: application/json" \
  -d '{
    "type": "system_alert",
    "data": {
      "level": "warning",
      "component": "AI Service",
      "message": "–ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤"
    }
  }'
```

---

## üìä –ú–û–ù–ò–¢–û–†–ò–ù–ì –ò –ê–ù–ê–õ–ò–¢–ò–ö–ê

### –ú–µ—Ç—Ä–∏–∫–∏ –±–æ—Ç–∞:
```javascript
// app/utils/telegram-analytics.js
class TelegramAnalytics {
  async trackMessage(type, chatId, success) {
    // –û—Ç–ø—Ä–∞–≤–∫–∞ –º–µ—Ç—Ä–∏–∫ –≤ –∞–Ω–∞–ª–∏—Ç–∏–∫—É
    await analytics.track('telegram_message', {
      type,
      chatId,
      success,
      timestamp: new Date()
    });
  }
  
  async getUsageStats() {
    return {
      messagesTotal: await this.getMessageCount(),
      activeUsers: await this.getActiveUsers(),
      commandsUsage: await this.getCommandsStats(),
      errorRate: await this.getErrorRate()
    };
  }
}
```

---

## üîÑ TROUBLESHOOTING

### –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è:

| –ü—Ä–æ–±–ª–µ–º–∞ | –ü—Ä–∏—á–∏–Ω–∞ | –†–µ—à–µ–Ω–∏–µ |
|----------|---------|---------|
| –ë–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç | –ù–µ–≤–µ—Ä–Ω—ã–π —Ç–æ–∫–µ–Ω | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–æ–∫–µ–Ω —á–µ—Ä–µ–∑ `/getMe` |
| 403 Forbidden | –ë–æ—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å |
| 400 Bad Request | –ù–µ–≤–µ—Ä–Ω—ã–π chat_id | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á–µ—Ä–µ–∑ `/getUpdates` |
| Webhook –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç | HTTPS –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω | –ù–∞—Å—Ç—Ä–æ–∏—Ç—å SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç |
| –°–æ–æ–±—â–µ–Ω–∏—è –Ω–µ –¥–æ—Ö–æ–¥—è—Ç | Rate limit | –£–º–µ–Ω—å—à–∏—Ç—å —á–∞—Å—Ç–æ—Ç—É –æ—Ç–ø—Ä–∞–≤–∫–∏ |

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:
```javascript
// app/utils/telegram-logger.js
function logTelegramEvent(event, data, error = null) {
  const logEntry = {
    timestamp: new Date().toISOString(),
    event,
    data,
    error: error?.message,
    stack: error?.stack
  };
  
  console.log('Telegram Event:', JSON.stringify(logEntry, null, 2));
  
  // –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Sentry –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
  if (error && typeof Sentry !== 'undefined') {
    Sentry.captureException(error, { extra: { event, data } });
  }
}
```

---

## üéØ –ì–û–¢–û–í–´–ô CHECKLIST

### –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º:
- [ ] ‚úÖ –ë–æ—Ç —Å–æ–∑–¥–∞–Ω —á–µ—Ä–µ–∑ @BotFather
- [ ] ‚úÖ –¢–æ–∫–µ–Ω –ø–æ–ª—É—á–µ–Ω –∏ –¥–æ–±–∞–≤–ª–µ–Ω –≤ .env
- [ ] ‚úÖ Chat ID –ø–æ–ª—É—á–µ–Ω –∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω
- [ ] ‚úÖ –ö–æ–º–∞–Ω–¥—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –≤ @BotFather
- [ ] ‚úÖ –û–ø–∏—Å–∞–Ω–∏–µ –∏ about –¥–æ–±–∞–≤–ª–µ–Ω—ã
- [ ] ‚úÖ Webhook –Ω–∞—Å—Ç—Ä–æ–µ–Ω (–µ—Å–ª–∏ –Ω—É–∂–µ–Ω)
- [ ] ‚úÖ –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω—ã
- [ ] ‚úÖ Rate limiting –≤–∫–ª—é—á–µ–Ω
- [ ] ‚úÖ –¢–µ—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è
- [ ] ‚úÖ –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞ —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] ‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–æ—Ö–æ–¥—è—Ç
- [ ] ‚úÖ –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è

**üéâ Telegram –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ!**

---

*–ü–æ–¥—Ä–æ–±–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–æ –≥–ª–∞–≤–Ω—ã–º —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–º Claude*  
*NeuroExpert Development Team*  
*–Ø–Ω–≤–∞—Ä—å 2025*